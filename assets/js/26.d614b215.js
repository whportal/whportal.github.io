(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{507:function(a,s,t){"use strict";t.r(s);var e=t(4),r=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("div",{staticClass:"custom-block tip"},[t("p",[a._v("Spring Boot 中事务失效原因和调用本类中事务方法的方案")])]),a._v(" "),t("h2",{attrs:{id:"解决同一类中事务失效"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#解决同一类中事务失效"}},[a._v("#")]),a._v(" 解决同一类中事务失效")]),a._v(" "),t("h3",{attrs:{id:"_1-在启动类添加注解"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-在启动类添加注解"}},[a._v("#")]),a._v(" 1.在启动类添加注解")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@EnableAspectJAutoProxy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("proxyTargetClass"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("exposeProxy "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// proxyTargetClass:控制AOP的实现方式，true为cglib，false为java默认的proxy")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// exposeProxy:控制代理的暴露方式，使aopContext能够访问，解决内部调用不能使用代理的场景，默认为false，")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br")])]),t("h2",{attrs:{id:"_2-使用代理调用本类中方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-使用代理调用本类中方法"}},[a._v("#")]),a._v(" 2.使用代理调用本类中方法")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("当前类 proxy = (当前类)AopContext.currentProxy();\nproxy.方法\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br")])]),t("h2",{attrs:{id:"事务失效情况"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#事务失效情况"}},[a._v("#")]),a._v(" 事务失效情况")]),a._v(" "),t("h3",{attrs:{id:"_1-使用默认的事务处理方式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-使用默认的事务处理方式"}},[a._v("#")]),a._v(" 1.使用默认的事务处理方式")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("因为在java的设计中，它认为不继承RuntimeException的异常是”checkException”或普通异常，如IOException，这些异常在java语法中是要求强制处理的。对于这些普通异常，spring默认它们都已经处理，所以默认不回滚。可以添加rollbackfor=Exception.class来表示所有的Exception都回滚。\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("h3",{attrs:{id:"_2-内部调用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-内部调用"}},[a._v("#")]),a._v(" 2.内部调用")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("不带事务的方法调用该类中带事务的方法，不会回滚。因为spring的回滚是用过代理模式生成的，如果是一个不带事务的方法调用该类的带事务的方法，直接通过this.xxx()调用，而不生成代理事务，所以事务不起作用\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("h3",{attrs:{id:"_3-方法不是public的"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-方法不是public的"}},[a._v("#")]),a._v(" 3.方法不是public的")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("@Transactional 只能用于 public 的方法上，否则事务不会失效，如果要用在非 public 方法上，可以开启 AspectJ 代理模式。\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])])])}),[],!1,null,null,null);s.default=r.exports}}]);